(function() {
  'use strict';

  const getParams = (urlString) => new URLSearchParams(urlString);

  const getPlayerParams = (configKeys, params) =>
    Array.from(params.keys())
      .filter((key) => !configKeys.includes(key))
      .reduce(
        (playerParamsString, filterdKey) =>
          (playerParamsString += `${filterdKey}=${params.get(filterdKey)}&`),
        '',
      );

  const v3 = {
    embedScript({ uuid, env, playerParams, type, domain }) {
      const embedCode = document.createElement('script');
      embedCode.type = 'text/javascript';
      embedCode.id = `vidyard_embed_code_${uuid}`;
      embedCode.src = `//${domain}.vidyard.${env}/${uuid}.js?v=3.1.1&type=${type}&${playerParams}`;
      return embedCode;
    },
    lightboxImage({ uuid, domain, env }) {
      const image = document.createElement('div');
      image.className = 'outer_vidyard_wrapper';
      image.innerHTML = `<div class="vidyard_wrapper" onclick="fn_vidyard_${uuid}();"><img alt="lightbox player alt" src="//${domain}.vidyard.${env}/${uuid}.jpg?" width="360"> <div class="vidyard_play_button"> <a href="javascript:void(0);"></a> </div> </div>`;
      return image;
    },
    inline(options) {
      return v3.embedScript({ ...options, type: 'inline' });
    },
    lightbox(options) {
      const embedCode = v3.embedScript({ ...options, type: 'lightbox' });
      const image = v3.lightboxImage(options);

      const embedWrapper = document.createElement('div');
      embedWrapper.appendChild(embedCode);
      embedWrapper.appendChild(image);
      return embedWrapper;
    },
  };

  const params = getParams(window.location.search);
  const config = {
    domain: params.get('domain') || 'play',
    env: params.get('env') || 'com',
    type: params.get('type') || 'v3inline',
    uuid: params.get('uuid') || 'QK4FcA7a4LRsfd5rZa26E8',
  };
  config.playerParams = getPlayerParams(Object.keys(config), params);
  console.log('params: ', config);

  let embed = document.createElement('p');
  switch (config.type) {
    case 'v3inline':
      embed = v3.inline(config);
      break;
    case 'v3lightbox':
      embed = v3.lightbox(config);
      break;
    default:
      embed.innerText = 'oh no, not a valid type';
      break;
  }
  document.body.appendChild(embed);
})();
